<%
  dates = []
  income_totals = {}
  while @startDate <= Time.new(Time.new.year,12,31) do
     new_date = @startDate += (14*24*60*60)
     dates.push(new_date)
     income_totals[new_date.strftime("%m%d")] = {:total => 0}
  end
%>

<h1><%= @budget.title %></h1>

<table class="table table-striped">

  <thead>
    <tr>
      <th>&nbsp;</th>
      <% dates.each do |date|  %>

      <th><%= date.strftime("%m/%d") %></th>
      <% end %>
    </tr>
  </thead>
  <tbody>


  <tr>
    <th style="color: #ffffff; background-color: #333333;">Income</th>
    <td colspan="<%= dates.length %>" style="background-color: #333333;"> &nbsp;</td>
  </tr>

  <% @budget.incomes.each do |income| %>
  <tr>
    <th nowrap="true"><%= income.title %></th>
    <% dates.each do |income_date| %>
        <%
           # Grab the income value
           income_value = income.income_value_by_date(income_date)
           # Set is to the totals hash
           income_totals[income_date.strftime('%m%d')]["Total"] =+ income_value
        %>
        <td class="income_cell_<%=income_date.strftime('%m%d')%>"> <%= number_to_currency(income_value) %></td>
    <% end %>
  </tr>
  <% end %>

  <tr>
    <th style="color: #333333; background-color: #3399ff;">Total</th>
    <% dates.each do |income_date| %>
        <td style="color: #333333; background-color: #3399ff; font-weight: bold;" id="income_total_cell_<%=income_date.strftime('%m%d')%>"> <%= number_to_currency(income_totals[income_date.strftime('%m%d')]["Total"]) %></td>
    <% end %>
  </tr>

  <tr>
    <th style="color: white; background-color: #333333;">Fixed Expenses</th>
    <td colspan="<%= dates.length %>"  style="background-color: #333333;"> &nbsp;</td>
  </tr>
  <% @budget.expenses.where(:isFixed => true).each do |expense| %>
     <tr>
       <th nowrap="true"><%= expense.title %></th>
       <% dates.each do |expense_date| %>
           <td> <%= number_to_currency(expense.expense_value_by_date expense_date)  %> </td>
       <% end %>
     </tr>
  <% end %>

  <tr>
    <th style="color: white; background-color: #333333">Variable Expenses</th>
    <td colspan="<%= dates.length %>" style="background-color: #333333;">&nbsp;</td>
  </tr>

  <% @budget.expenses.where(:isFixed => false).each do |expense| %>
      <tr>
        <th nowrap="true"><%= expense.title %></th>
        <% dates.each do |expense_date| %>
            <td> <%= number_to_currency(expense.expense_value_by_date expense_date)  %> </td>
        <% end %>
      </tr>
  <% end %>

  </tbody>
</table>

<div id="expenseModal" class="modal fade" style="display: none;">
<div class="modal-header">
  <a href="" class="close" data-dismiss="modal">x</a>
  <h3>Add Expense</h3>
</div>
<div class="modal-body">Loading..</div>
<div class="modal-footer">
  <a href="#" class="btn btn-primary">Save</a>
  <a href="#" class="btn">Cancel</a>
</div>
</div>

<div id="incomeModal" class="modal fade" style="display: none;">
  <div class="modal-header">
    <a href="" class="close" data-dismiss="modal">x</a>
    <h3>Add Income</h3>
  </div>
  <div class="modal-body">Loading..</div>
  <div class="modal-footer">
    <a href="#" class="btn btn-primary">Save</a>
    <a href="#" class="btn">Cancel</a>
  </div>
</div>

<script>
  $("#expenseModal").modal({"show": false});
</script>