%tr
  %th{:style => "color: white; background-color: #333333;"}
    %span.section-title Variable Expenses
    %a{:href => "javascript:void(0)", :class => "icon-white icon-plus-sign btn_new_expense", :type => "variable"}/
  %td{:colspan => @budget.periods.length, :style => "background-color: #333333;"} &nbsp;
%tbody.variable_expenses
  - @budget.expenses.where(:isfixed => false).each do |expense|
    %tr.variable_expense_row{:id => "expense_row_#{expense.id}"}
      %th{:nowrap => true}
        %div{:style => "position: relative;"}
          %span.expense_title{:id => "expense_title_#{expense.id}"}= expense.title
          %span{:style => "position: absolute; right: 10px;"}
            %a{:href => "javascript:void(0)", :expense_id => expense.id, :class => "icon-edit btn_edit_expense"}
            %a{:href => "javascript:void(0)", :expense_id => expense.id, :class => "icon-remove-circle btn_delete_expense"}
        %div= expense.amount.nil? ? "$0.00" : number_to_currency(expense.amount)

      - @periods.each do |period|
        - expense_value = period.find_expense_values(expense)
        - if expense.amount.nil?
          - percent_spent = 0
        - else
          - percent_spent = expense_value / expense.amount * 100
          - if percent_spent > 100
            -progress_css = "progress-danger progress-striped active"
          -elsif percent_spent < 100 && percent_spent > 75
            -progress_css = "progress-warning"
          -else
            -progress_css = "progress-success"

        %td.expense_value{:id => "expense_value_#{expense.id}_#{period.id}",:expense_id => expense.id,:style => "cursor: pointer",:period_id => period.id}
          %span= number_to_currency(expense_value)
          %div{:class => "progress #{progress_css}"}
            .bar{:style => "width: #{percent_spent}%"}

%tbody.variable_expense_totals
  %tr
    %th.total-cell Total
    - @periods.each do |period|
      %td.total-cell{:id => "variable_expense_total_cell_#{period.id}",
                     :nowrap => true}

%div{:class => "modal fade hide", :id => "expense_edit_container"}/
