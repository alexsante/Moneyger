%tbody.variable_expenses
  %tr
    %th{:style => "color: white; background-color: #333333;"} Variable Expenses
    %td{:colspan => @budget.periods.length, :style => "background-color: #333333;"} &nbsp;

    - @budget.expenses.where(:isfixed => false).each do |expense|
      %tr
        %th{:nowrap => true}
          %span.expense_title= expense.title
          %div= expense.amount.nil? ? "$0.00" : number_to_currency(expense.amount)

        - @periods.each do |period|
          - expense_value = period.find_expense_values(expense)
          - if expense.amount.nil?
            - percent_spent = 0
          - else
            - percent_spent = expense_value / expense.amount * 100
            - if percent_spent > 100
              -progress_css = "progress-danger progress-striped active"
            -elsif percent_spent < 100 && percent_spent > 75
              -progress_css = "progress-warning"
            -else
              -progress_css = "progress-success"

          %td.expense_value{:id => "expense_value_#{expense.id}_#{period.id}",:expense_id => expense.id,:style => "cursor: pointer",:period_id => period.id}
            %span= number_to_currency(expense_value)
            %div{:class => "progress #{progress_css}"}
              .bar{:style => "width: #{percent_spent}%"}

%tbody.variable_expense_totals
  %tr
    %th.total-cell Total
    - @periods.each do |period|
      %td.total-cell{:id => "variable_expense_total_cell_#{period.id}",
                     :nowrap => true}

%div{:class => "modal fade hide", :id => "expense_edit_container"}/